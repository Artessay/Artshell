\doxysection{Executor.\+cpp}
\label{_executor_8cpp_source}\index{src/Executor.cpp@{src/Executor.cpp}}
\textbf{ 浏览该文件的文档.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001 }
\DoxyCodeLine{00012 \textcolor{preprocessor}{\#include "{}common.h"{}}}
\DoxyCodeLine{00013 \textcolor{preprocessor}{\#include "{}myshell.h"{}}}
\DoxyCodeLine{00014 \textcolor{preprocessor}{\#include "{}Console.h"{}}}
\DoxyCodeLine{00015 \textcolor{preprocessor}{\#include "{}Display.h"{}}}
\DoxyCodeLine{00016 \textcolor{preprocessor}{\#include "{}Executor.h"{}}}
\DoxyCodeLine{00017 \textcolor{preprocessor}{\#include "{}ProcessManager.h"{}}}
\DoxyCodeLine{00018 }
\DoxyCodeLine{00019 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{00020 \textcolor{preprocessor}{\#include <sstream>}}
\DoxyCodeLine{00021 }
\DoxyCodeLine{00022 \textcolor{preprocessor}{\#include <fcntl.h>}}
\DoxyCodeLine{00023 \textcolor{preprocessor}{\#include <assert.h>}}
\DoxyCodeLine{00024 \textcolor{preprocessor}{\#include <dirent.h>}}
\DoxyCodeLine{00025 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{00026 \textcolor{preprocessor}{\#include <unistd.h>}}
\DoxyCodeLine{00027 }
\DoxyCodeLine{00028 \textcolor{preprocessor}{\#include <sys/stat.h>}}
\DoxyCodeLine{00029 \textcolor{preprocessor}{\#include <sys/wait.h>}}
\DoxyCodeLine{00030 \textcolor{preprocessor}{\#include <sys/types.h>}}
\DoxyCodeLine{00031 }
\DoxyCodeLine{00033 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{bool} test\_tty(\textcolor{keyword}{const} \textcolor{keywordtype}{char} * file\_name);}
\DoxyCodeLine{00034 }
\DoxyCodeLine{00036 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char}* OperandArray[] = }
\DoxyCodeLine{00037 \{}
\DoxyCodeLine{00038     \textcolor{stringliteral}{"{}bg"{}}, \textcolor{stringliteral}{"{}cd"{}}, \textcolor{stringliteral}{"{}clr"{}}, \textcolor{stringliteral}{"{}dir"{}}, \textcolor{stringliteral}{"{}echo"{}}, \textcolor{stringliteral}{"{}exec"{}}, \textcolor{stringliteral}{"{}exit"{}}, \textcolor{stringliteral}{"{}fg"{}},}
\DoxyCodeLine{00039     \textcolor{stringliteral}{"{}help"{}}, \textcolor{stringliteral}{"{}jobs"{}}, \textcolor{stringliteral}{"{}myshell"{}}, \textcolor{stringliteral}{"{}pwd"{}}, \textcolor{stringliteral}{"{}set"{}}, \textcolor{stringliteral}{"{}test"{}}, \textcolor{stringliteral}{"{}time"{}}, \textcolor{stringliteral}{"{}umask"{}}}
\DoxyCodeLine{00040 \};}
\DoxyCodeLine{00041 }
\DoxyCodeLine{00042 Executor::Executor(Console *model, Display *view)}
\DoxyCodeLine{00043 : console\_(model), display\_(view)}
\DoxyCodeLine{00044 \{}
\DoxyCodeLine{00045     assert(console\_ != \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00046     assert(display\_ != \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00047 }
\DoxyCodeLine{00049     \textcolor{keywordtype}{int} i = 0;}
\DoxyCodeLine{00050 }
\DoxyCodeLine{00051     FunctionArray[i] = \&Executor::execute\_bg;       ++i;}
\DoxyCodeLine{00052     FunctionArray[i] = \&Executor::execute\_cd;       ++i;}
\DoxyCodeLine{00053     FunctionArray[i] = \&Executor::execute\_clr;      ++i;}
\DoxyCodeLine{00054     FunctionArray[i] = \&Executor::execute\_dir;      ++i;}
\DoxyCodeLine{00055     FunctionArray[i] = \&Executor::execute\_echo;     ++i;}
\DoxyCodeLine{00056     FunctionArray[i] = \&Executor::execute\_exec;     ++i;}
\DoxyCodeLine{00057     FunctionArray[i] = \&Executor::execute\_exit;     ++i;}
\DoxyCodeLine{00058     FunctionArray[i] = \&Executor::execute\_fg;       ++i;}
\DoxyCodeLine{00059 }
\DoxyCodeLine{00060     FunctionArray[i] = \&Executor::execute\_help;     ++i;}
\DoxyCodeLine{00061     FunctionArray[i] = \&Executor::execute\_jobs;     ++i;}
\DoxyCodeLine{00062     FunctionArray[i] = \&Executor::execute\_myshell;  ++i;}
\DoxyCodeLine{00063     FunctionArray[i] = \&Executor::execute\_pwd;      ++i;}
\DoxyCodeLine{00064     FunctionArray[i] = \&Executor::execute\_set;      ++i;}
\DoxyCodeLine{00065     FunctionArray[i] = \&Executor::execute\_test;     ++i;}
\DoxyCodeLine{00066     FunctionArray[i] = \&Executor::execute\_time;     ++i;}
\DoxyCodeLine{00067     FunctionArray[i] = \&Executor::execute\_umask;    ++i;}
\DoxyCodeLine{00068 }
\DoxyCodeLine{00069     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00070 \}}
\DoxyCodeLine{00071 }
\DoxyCodeLine{00072 Executor::\string~Executor()}
\DoxyCodeLine{00073 \{}
\DoxyCodeLine{00074 \}}
\DoxyCodeLine{00075 }
\DoxyCodeLine{00076 sh\_err\_t Executor::execute(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00077 \textcolor{keyword}{}\{}
\DoxyCodeLine{00078     \textcolor{keywordflow}{if} (argc == 0)}
\DoxyCodeLine{00079         \textcolor{keywordflow}{return} SH\_SUCCESS;  \textcolor{comment}{// 没有输入命令则无需处理}}
\DoxyCodeLine{00080     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (argv == \textcolor{keyword}{nullptr} || argv[0] == \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00081     \{}
\DoxyCodeLine{00082         assert(\textcolor{keyword}{false});}
\DoxyCodeLine{00083         \textcolor{keywordflow}{return} SH\_FAILED;   \textcolor{comment}{// 解析可能产生了错误}}
\DoxyCodeLine{00084     \}}
\DoxyCodeLine{00085 }
\DoxyCodeLine{00086     \textcolor{comment}{/* 挂起命令处理 */}}
\DoxyCodeLine{00087     \textcolor{keywordtype}{int}\& argc\_ = \textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{int}\&\textcolor{keyword}{>}(argc);}
\DoxyCodeLine{00088     \textcolor{keywordflow}{if} (strcmp(argv[argc -\/ 1], \textcolor{stringliteral}{"{}\&"{}}) == 0)    \textcolor{comment}{// 后台挂起}}
\DoxyCodeLine{00089     \{}
\DoxyCodeLine{00090         -\/-\/argc\_;}
\DoxyCodeLine{00091         \textcolor{keywordflow}{if} (argc == 0)  \textcolor{comment}{// 参数错误}}
\DoxyCodeLine{00092             \textcolor{keywordflow}{return} SH\_ARGS;}
\DoxyCodeLine{00093 }
\DoxyCodeLine{00094         pid\_t pid;}
\DoxyCodeLine{00095         \textcolor{keywordflow}{if} ((pid = fork()) < 0)}
\DoxyCodeLine{00096         \{ }
\DoxyCodeLine{00097             \textcolor{comment}{/* 错误处理 */}}
\DoxyCodeLine{00098             \textcolor{keywordflow}{throw} \textcolor{stringliteral}{"{}Fork Error, 错误终止"{}};}
\DoxyCodeLine{00099         \}}
\DoxyCodeLine{00100         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (pid == 0)}
\DoxyCodeLine{00101         \{}
\DoxyCodeLine{00102             \textcolor{comment}{/* 子进程 */}  }
\DoxyCodeLine{00103             setenv(\textcolor{stringliteral}{"{}parent"{}}, console\_-\/>shell\_path\_env, 1);  \textcolor{comment}{// 设置调用子进程的父进程}}
\DoxyCodeLine{00104             Console::child\_process\_id = getpid();}
\DoxyCodeLine{00105 }
\DoxyCodeLine{00106 \textcolor{preprocessor}{            \#ifdef \_DEBUG\_}}
\DoxyCodeLine{00107             printf(\textcolor{stringliteral}{"{}child pid: \%d\(\backslash\)n"{}}, console\_-\/>process\_id);}
\DoxyCodeLine{00108 \textcolor{preprocessor}{            \#endif}}
\DoxyCodeLine{00109 }
\DoxyCodeLine{00110             setpgid(0, 0);}
\DoxyCodeLine{00111             signal(SIGINT, SIG\_DFL);    \textcolor{comment}{// 恢复Ctrl C信号}}
\DoxyCodeLine{00112             signal(SIGTSTP, SIG\_DFL);   \textcolor{comment}{// 恢复Ctrl Z信号}}
\DoxyCodeLine{00113 }
\DoxyCodeLine{00114             \textcolor{keywordtype}{char} **\&argv\_ = \textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{char} **\&\textcolor{keyword}{>}(argv);}
\DoxyCodeLine{00115             argv\_[argc] = NULL;}
\DoxyCodeLine{00116 \textcolor{preprocessor}{            \#ifdef \_DEBUG\_}}
\DoxyCodeLine{00117             Argument\_Display(argc, argv);}
\DoxyCodeLine{00118 \textcolor{preprocessor}{            \#endif}}
\DoxyCodeLine{00119 }
\DoxyCodeLine{00120             \textcolor{comment}{// 执行命令}}
\DoxyCodeLine{00121             shell\_function(argc, argv, env);}
\DoxyCodeLine{00122 }
\DoxyCodeLine{00123             \textcolor{comment}{// 执行完成时退出}}
\DoxyCodeLine{00124             \textcolor{keywordflow}{return} SH\_EXIT;}
\DoxyCodeLine{00125         \}}
\DoxyCodeLine{00126         \textcolor{keywordflow}{else}}
\DoxyCodeLine{00127         \{}
\DoxyCodeLine{00128             \textcolor{comment}{/* 父进程 */}}
\DoxyCodeLine{00129 \textcolor{preprocessor}{            \#ifdef \_DEBUG\_}}
\DoxyCodeLine{00130             printf(\textcolor{stringliteral}{"{}parent pid: \%d\(\backslash\)n"{}}, pid);}
\DoxyCodeLine{00131 \textcolor{preprocessor}{            \#endif}}
\DoxyCodeLine{00132 }
\DoxyCodeLine{00133             \textcolor{comment}{// 添加进程列表}}
\DoxyCodeLine{00134             \textcolor{keywordtype}{char} **\&argv\_ = \textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{char} **\&\textcolor{keyword}{>}(argv);}
\DoxyCodeLine{00135             argv\_[argc] = NULL;}
\DoxyCodeLine{00136             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} jobid = console\_-\/>AddJob(pid, Running, argc\_, argv\_);}
\DoxyCodeLine{00137             \textcolor{comment}{// console\_-\/>process\_id = getpid();    // 可以看到，这里的pid是没有改变的}}
\DoxyCodeLine{00138             console\_-\/>child\_process\_id = pid;}
\DoxyCodeLine{00139             }
\DoxyCodeLine{00140             \textcolor{comment}{// 打印当前进程}}
\DoxyCodeLine{00141             \textcolor{keywordtype}{char} buffer[32];}
\DoxyCodeLine{00142             snprintf(buffer, 32, \textcolor{stringliteral}{"{}[\%u] \%d\(\backslash\)n"{}}, jobid, pid);}
\DoxyCodeLine{00143             \textcolor{keywordflow}{if} (write(console\_-\/>output\_std\_fd, buffer, strlen(buffer)) == -\/1)}
\DoxyCodeLine{00144                 \textcolor{keywordflow}{throw} std::exception();}
\DoxyCodeLine{00145             }
\DoxyCodeLine{00146             \textcolor{comment}{// setpgid(pid, pid);}}
\DoxyCodeLine{00147 }
\DoxyCodeLine{00148             \textcolor{comment}{// // 将前端设置为子进程}}
\DoxyCodeLine{00149             \textcolor{comment}{// tcsetpgrp(STDIN\_FILENO, pid);}}
\DoxyCodeLine{00150             \textcolor{comment}{// tcsetpgrp(STDOUT\_FILENO, pid);}}
\DoxyCodeLine{00151             \textcolor{comment}{// tcsetpgrp(STDERR\_FILENO, pid);}}
\DoxyCodeLine{00152             }
\DoxyCodeLine{00153             \textcolor{comment}{// int status;}}
\DoxyCodeLine{00154             \textcolor{comment}{// waitpid(pid, \&status, WNOHANG);}}
\DoxyCodeLine{00155 }
\DoxyCodeLine{00156             \textcolor{comment}{// // 将前端设置为父进程}}
\DoxyCodeLine{00157             \textcolor{comment}{// tcsetpgrp(STDIN\_FILENO, getpid());}}
\DoxyCodeLine{00158             \textcolor{comment}{// tcsetpgrp(STDOUT\_FILENO, getpid());}}
\DoxyCodeLine{00159             \textcolor{comment}{// tcsetpgrp(STDERR\_FILENO, getgid());}}
\DoxyCodeLine{00160 }
\DoxyCodeLine{00161             \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00162         \}}
\DoxyCodeLine{00163     \}}
\DoxyCodeLine{00164     }
\DoxyCodeLine{00165     \textcolor{keywordflow}{return} shell\_function(argc, argv, env);}
\DoxyCodeLine{00166 \}}
\DoxyCodeLine{00167 }
\DoxyCodeLine{00168 sh\_err\_t Executor::shell\_function(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00169 \textcolor{keyword}{}\{}
\DoxyCodeLine{00170     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *op = argv[0];}
\DoxyCodeLine{00171     console\_-\/>argc = argc;}
\DoxyCodeLine{00172     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < argc; ++i)}
\DoxyCodeLine{00173         strncpy(console\_-\/>argv[i], argv[i], BUFFER\_SIZE);}
\DoxyCodeLine{00174 }
\DoxyCodeLine{00175 \textcolor{preprocessor}{\#ifdef \_DEBUG\_}}
\DoxyCodeLine{00176     Argument\_Display(argc, argv);}
\DoxyCodeLine{00177 }
\DoxyCodeLine{00178     \textcolor{comment}{// 以下命令不要求实现，仅供练习使用}}
\DoxyCodeLine{00179     \textcolor{keywordflow}{if} (strcmp(op, \textcolor{stringliteral}{"{}date"{}}) == 0)}
\DoxyCodeLine{00180     \{}
\DoxyCodeLine{00181         \textcolor{keywordflow}{return} execute\_date(argc, argv, env);}
\DoxyCodeLine{00182     \}}
\DoxyCodeLine{00183     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(op, \textcolor{stringliteral}{"{}clear"{}}) == 0)}
\DoxyCodeLine{00184     \{}
\DoxyCodeLine{00185         \textcolor{keywordflow}{return} execute\_clear(argc, argv, env);}
\DoxyCodeLine{00186     \}}
\DoxyCodeLine{00187     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(op, \textcolor{stringliteral}{"{}env"{}}) == 0)}
\DoxyCodeLine{00188     \{}
\DoxyCodeLine{00189         \textcolor{keywordflow}{return} execute\_env(argc, argv, env);}
\DoxyCodeLine{00190     \}}
\DoxyCodeLine{00191     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(op, \textcolor{stringliteral}{"{}who"{}}) == 0)}
\DoxyCodeLine{00192     \{}
\DoxyCodeLine{00193         \textcolor{keywordflow}{return} execute\_who(argc, argv, env);}
\DoxyCodeLine{00194     \}}
\DoxyCodeLine{00195     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(op, \textcolor{stringliteral}{"{}mkdir"{}}) == 0)}
\DoxyCodeLine{00196     \{}
\DoxyCodeLine{00197         \textcolor{keywordflow}{return} execute\_mkdir(argc, argv, env);}
\DoxyCodeLine{00198     \}}
\DoxyCodeLine{00199     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strcmp(op, \textcolor{stringliteral}{"{}rmdir"{}}) == 0)}
\DoxyCodeLine{00200     \{}
\DoxyCodeLine{00201         \textcolor{keywordflow}{return} execute\_rmdir(argc, argv, env);}
\DoxyCodeLine{00202     \}}
\DoxyCodeLine{00203 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00204 }
\DoxyCodeLine{00206     \textcolor{keywordtype}{int} index = Binary\_Search(0, \textcolor{keyword}{sizeof}(OperandArray)/\textcolor{keyword}{sizeof}(OperandArray[0]), op, OperandArray, strcmp);}
\DoxyCodeLine{00207 \textcolor{preprocessor}{\#ifdef \_DEBUG\_}}
\DoxyCodeLine{00208     printf(\textcolor{stringliteral}{"{}index: \%d op: \%s\(\backslash\)n"{}}, index, OperandArray[index>=0?index:0]);}
\DoxyCodeLine{00209 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00210 }
\DoxyCodeLine{00211     \textcolor{keywordflow}{if} (index >= 0 \&\& index < FunctionNumber)   \textcolor{comment}{// 找到了}}
\DoxyCodeLine{00212     \{}
\DoxyCodeLine{00213         MemFuncPtr FunctionPointer = FunctionArray[index];  \textcolor{comment}{// 找到对应的函数指针}}
\DoxyCodeLine{00214         \textcolor{keywordflow}{return} (*this.*FunctionPointer)(argc, argv, env);   \textcolor{comment}{// 执行内部函数}}
\DoxyCodeLine{00215     \}}
\DoxyCodeLine{00216     }
\DoxyCodeLine{00217 }
\DoxyCodeLine{00218     \textcolor{comment}{// 其他的命令行输入被解释为程序调用，}}
\DoxyCodeLine{00219     \textcolor{comment}{// shell 创建并执行这个程序，并作为自己的子进程}}
\DoxyCodeLine{00220     pid\_t pid = getpid(); \textcolor{comment}{// 获取当前进程id，用于处理父进程行为}}
\DoxyCodeLine{00221     \textcolor{keywordflow}{if} ((pid = vfork()) < 0)}
\DoxyCodeLine{00222     \{ }
\DoxyCodeLine{00223         \textcolor{comment}{/* 错误处理 */}}
\DoxyCodeLine{00224         \textcolor{keywordflow}{throw} \textcolor{stringliteral}{"{}Fork Error, 错误终止"{}};}
\DoxyCodeLine{00225     \}}
\DoxyCodeLine{00226     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (pid == 0)}
\DoxyCodeLine{00227     \{}
\DoxyCodeLine{00228         \textcolor{comment}{/* 子进程 */}  }
\DoxyCodeLine{00229         setenv(\textcolor{stringliteral}{"{}parent"{}}, console\_-\/>shell\_path\_env, 1);  \textcolor{comment}{// 设置调用子进程的父进程}}
\DoxyCodeLine{00230         \textcolor{keywordtype}{int} status\_code = execvp(argv[0], argv);        \textcolor{comment}{// 在子进程之中执行}}
\DoxyCodeLine{00231 }
\DoxyCodeLine{00232         \textcolor{keywordflow}{if} (status\_code == -\/1)}
\DoxyCodeLine{00233         \{}
\DoxyCodeLine{00234             \textcolor{keywordflow}{throw} \textcolor{stringliteral}{"{}Execvp Error, terminated incorrectly"{}};}
\DoxyCodeLine{00235         \}}
\DoxyCodeLine{00236 }
\DoxyCodeLine{00237         \textcolor{keywordflow}{return} SH\_UNDEFINED; \textcolor{comment}{// 未识别的命令}}
\DoxyCodeLine{00238     \}}
\DoxyCodeLine{00239     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00240     \{}
\DoxyCodeLine{00241         \textcolor{comment}{/* 父进程 */}}
\DoxyCodeLine{00242         console\_-\/>child\_process\_id = pid;   \textcolor{comment}{// 设置子进程pid，用于Ctrl+Z信号处理}}
\DoxyCodeLine{00243         wait(NULL); \textcolor{comment}{// 等待子进程结束后再继续执行，保证执行顺序不混乱}}
\DoxyCodeLine{00244         console\_-\/>child\_process\_id = -\/1;}
\DoxyCodeLine{00245         \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00246     \}}
\DoxyCodeLine{00247 }
\DoxyCodeLine{00248     \textcolor{keywordflow}{return} SH\_FAILED;}
\DoxyCodeLine{00249 \}}
\DoxyCodeLine{00250 }
\DoxyCodeLine{00251 sh\_err\_t Executor::execute\_cd(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00252 \textcolor{keyword}{}\{}
\DoxyCodeLine{00253     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}cd"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00254 }
\DoxyCodeLine{00255     std::string path;}
\DoxyCodeLine{00256     \textcolor{keywordflow}{if} (argc == 1)}
\DoxyCodeLine{00257     \{}
\DoxyCodeLine{00258         \textcolor{comment}{// 默认无参数时为主目录}}
\DoxyCodeLine{00259         path = console\_-\/>home;}
\DoxyCodeLine{00260     \}}
\DoxyCodeLine{00261     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (argc == 2)}
\DoxyCodeLine{00262     \{}
\DoxyCodeLine{00263         path = argv[1];}
\DoxyCodeLine{00264         }
\DoxyCodeLine{00265 \textcolor{preprocessor}{        \#ifdef \_DEBUG\_}}
\DoxyCodeLine{00266         printf(\textcolor{stringliteral}{"{}char: \%c \%d\(\backslash\)n"{}}, path[0], (path[0] == \textcolor{charliteral}{'\string~'}));}
\DoxyCodeLine{00267 \textcolor{preprocessor}{        \#endif}}
\DoxyCodeLine{00268 }
\DoxyCodeLine{00269         \textcolor{keywordflow}{if} (path[0] == \textcolor{charliteral}{'\string~'}) \textcolor{comment}{// 对于\string~目录需要特殊判断}}
\DoxyCodeLine{00270         \{}
\DoxyCodeLine{00271             \textcolor{comment}{// 将\string~替换为主目录}}
\DoxyCodeLine{00272             path.replace(0, 1, console\_-\/>home);}
\DoxyCodeLine{00273         \}}
\DoxyCodeLine{00274 }
\DoxyCodeLine{00275 \textcolor{preprocessor}{        \#ifdef \_DEBUG\_}}
\DoxyCodeLine{00276         printf(\textcolor{stringliteral}{"{}Argv: \%s\(\backslash\)nHome: \%s\(\backslash\)nPath: \%s\(\backslash\)n"{}}, argv[1], console\_-\/>home, path.c\_str());}
\DoxyCodeLine{00277 \textcolor{preprocessor}{        \#endif}}
\DoxyCodeLine{00278     \}}
\DoxyCodeLine{00279     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00280     \{}
\DoxyCodeLine{00281         \textcolor{keywordflow}{return} SH\_ARGS; \textcolor{comment}{// 参数错误}}
\DoxyCodeLine{00282     \}}
\DoxyCodeLine{00283 }
\DoxyCodeLine{00284     \textcolor{comment}{// 更改目录}}
\DoxyCodeLine{00285     \textcolor{keywordtype}{int} ret = chdir(path.c\_str());}
\DoxyCodeLine{00286     \textcolor{keywordflow}{if} (ret != 0)   \textcolor{comment}{// 打开目录异常}}
\DoxyCodeLine{00287     \{}
\DoxyCodeLine{00288         \textcolor{keywordflow}{throw} ((std::string)\textcolor{stringliteral}{"{}cd: 无法打开路径 "{}} + path);}
\DoxyCodeLine{00289     \}}
\DoxyCodeLine{00290 }
\DoxyCodeLine{00291     \textcolor{comment}{// 重新设置控制台环境与系统环境变量}}
\DoxyCodeLine{00292     \textcolor{keywordflow}{if} (getcwd(console\_-\/>current\_working\_dictionary, BUFFER\_SIZE) != \textcolor{keyword}{nullptr} )}
\DoxyCodeLine{00293         setenv(\textcolor{stringliteral}{"{}PWD"{}}, console\_-\/>current\_working\_dictionary, 1);}
\DoxyCodeLine{00294     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00295         \textcolor{keywordflow}{throw} \textcolor{stringliteral}{"{}get cwd error"{}};}
\DoxyCodeLine{00296 }
\DoxyCodeLine{00297     \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00298 \}}
\DoxyCodeLine{00299 }
\DoxyCodeLine{00300 sh\_err\_t Executor::execute\_pwd(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00301 \textcolor{keyword}{}\{}
\DoxyCodeLine{00302     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}pwd"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00303     display\_-\/>message(console\_-\/>current\_working\_dictionary);}
\DoxyCodeLine{00304     display\_-\/>message(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00305     \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00306 \}}
\DoxyCodeLine{00307 }
\DoxyCodeLine{00308 sh\_err\_t Executor::execute\_time(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00309 \textcolor{keyword}{}\{}
\DoxyCodeLine{00310     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}time"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00311 }
\DoxyCodeLine{00312     \textcolor{comment}{// 相当于env命令，从兼容性的角度出发，这里选择调用env命令以兼容Linux用户需求以及后续开发}}
\DoxyCodeLine{00313     \textcolor{keywordflow}{return} execute\_date(argc, argv, env);}
\DoxyCodeLine{00314 \}}
\DoxyCodeLine{00315 }
\DoxyCodeLine{00316 sh\_err\_t Executor::execute\_clr(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00317 \textcolor{keyword}{}\{}
\DoxyCodeLine{00318     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}clr"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00319     }
\DoxyCodeLine{00320     \textcolor{comment}{// 相当于clear命令，从兼容性的角度出发，这里选择调用env命令以兼容Linux用户需求以及后续开发}}
\DoxyCodeLine{00321     \textcolor{keywordflow}{return} execute\_clear(argc, argv, env);}
\DoxyCodeLine{00322 \}}
\DoxyCodeLine{00323 }
\DoxyCodeLine{00324 sh\_err\_t Executor::execute\_dir(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00325 \textcolor{keyword}{}\{}
\DoxyCodeLine{00326     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}dir"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00327     }
\DoxyCodeLine{00328     std::string real\_path;}
\DoxyCodeLine{00329     \textcolor{keywordflow}{if} (argc == 1)}
\DoxyCodeLine{00330     \{}
\DoxyCodeLine{00331         \textcolor{comment}{// 默认无参数时为当前目录}}
\DoxyCodeLine{00332         real\_path = console\_-\/>current\_working\_dictionary;}
\DoxyCodeLine{00333     \}}
\DoxyCodeLine{00334     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (argc == 2)}
\DoxyCodeLine{00335     \{}
\DoxyCodeLine{00336         real\_path = argv[1];}
\DoxyCodeLine{00337         \textcolor{keywordflow}{if} (real\_path[0] == \textcolor{charliteral}{'\string~'}) \textcolor{comment}{// 对于\string~目录需要特殊判断}}
\DoxyCodeLine{00338         \{}
\DoxyCodeLine{00339             \textcolor{comment}{// 将\string~替换为主目录}}
\DoxyCodeLine{00340             real\_path.replace(0, 1, console\_-\/>home);}
\DoxyCodeLine{00341         \}}
\DoxyCodeLine{00342     \}}
\DoxyCodeLine{00343     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00344     \{}
\DoxyCodeLine{00345         \textcolor{keywordflow}{return} SH\_ARGS; \textcolor{comment}{// 参数错误}}
\DoxyCodeLine{00346     \}}
\DoxyCodeLine{00347     }
\DoxyCodeLine{00348     \textcolor{keywordtype}{int} ret;                \textcolor{comment}{// 用于接受返回值}}
\DoxyCodeLine{00349     DIR *direction\_pointer; \textcolor{comment}{// 目录指针}}
\DoxyCodeLine{00350     \textcolor{keywordflow}{if} ((direction\_pointer = opendir(real\_path.c\_str())) == NULL)}
\DoxyCodeLine{00351     \{}
\DoxyCodeLine{00352         \textcolor{keywordflow}{throw} ((std::string)\textcolor{stringliteral}{"{}dir: 无法打开路径 "{}} + real\_path);}
\DoxyCodeLine{00353     \}}
\DoxyCodeLine{00354 }
\DoxyCodeLine{00355     \textcolor{comment}{// 临时将进程目录调整为指定目录}}
\DoxyCodeLine{00356     ret = chdir(real\_path.c\_str());}
\DoxyCodeLine{00357     \textcolor{keywordflow}{if} (ret != 0)   \textcolor{comment}{// 打开目录异常}}
\DoxyCodeLine{00358     \{}
\DoxyCodeLine{00359         \textcolor{keywordflow}{throw} ((std::string)\textcolor{stringliteral}{"{}dir: 无法打开路径 "{}} + real\_path);}
\DoxyCodeLine{00360     \}}
\DoxyCodeLine{00361 }
\DoxyCodeLine{00362     \textcolor{keyword}{struct }dirent *entry;   \textcolor{comment}{// 目录内容}}
\DoxyCodeLine{00363     \textcolor{keywordflow}{while} ((entry = readdir(direction\_pointer)) != NULL)}
\DoxyCodeLine{00364     \{}
\DoxyCodeLine{00365         \textcolor{keyword}{struct }stat stat\_buffer;    \textcolor{comment}{// 存储stat结构}}
\DoxyCodeLine{00366         lstat(entry-\/>d\_name, \&stat\_buffer); \textcolor{comment}{// 根据文件名获得文件stat结构}}
\DoxyCodeLine{00367 }
\DoxyCodeLine{00368         \textcolor{keywordtype}{char} buffer[BUFFER\_SIZE];}
\DoxyCodeLine{00369         \textcolor{keywordflow}{if} (S\_ISDIR(stat\_buffer.st\_mode))   \textcolor{comment}{// 检测该数据项是否是一个目录}}
\DoxyCodeLine{00370         \{}
\DoxyCodeLine{00371             \textcolor{comment}{// 数据项是一个目录}}
\DoxyCodeLine{00372 }
\DoxyCodeLine{00373             \textcolor{keywordflow}{if} (strcmp(\textcolor{stringliteral}{"{}."{}}, entry-\/>d\_name) == 0 ||}
\DoxyCodeLine{00374                 strcmp(\textcolor{stringliteral}{"{}.."{}}, entry-\/>d\_name) == 0)}
\DoxyCodeLine{00375             \{}
\DoxyCodeLine{00376                 \textcolor{comment}{// 如果是.或者..目录，则不显示}}
\DoxyCodeLine{00377                 \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00378             \}}
\DoxyCodeLine{00379 }
\DoxyCodeLine{00380             \textcolor{comment}{// 目录用蓝色显示}}
\DoxyCodeLine{00381             snprintf(buffer, BUFFER\_SIZE, \textcolor{stringliteral}{"{}\(\backslash\)033[34m\%s\(\backslash\)033[0m  "{}}, entry-\/>d\_name);}
\DoxyCodeLine{00382             \textcolor{keywordflow}{if} (console\_-\/>redirect\_output == \textcolor{keyword}{false}) }
\DoxyCodeLine{00383                 display\_-\/>message(buffer);}
\DoxyCodeLine{00384             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00385             \{}
\DoxyCodeLine{00386                 display\_-\/>message(entry-\/>d\_name);}
\DoxyCodeLine{00387                 display\_-\/>message(\textcolor{stringliteral}{"{}  "{}});}
\DoxyCodeLine{00388             \}}
\DoxyCodeLine{00389         \}}
\DoxyCodeLine{00390         \textcolor{keywordflow}{else}}
\DoxyCodeLine{00391         \{}
\DoxyCodeLine{00392             \textcolor{comment}{// 普通文件}}
\DoxyCodeLine{00393             \textcolor{keywordflow}{switch} (entry-\/>d\_type)}
\DoxyCodeLine{00394             \{}
\DoxyCodeLine{00395                 \textcolor{keywordflow}{case} DT\_UNKNOWN:    \textcolor{comment}{// 目录文件未知文件用红色}}
\DoxyCodeLine{00396                     snprintf(buffer, BUFFER\_SIZE, \textcolor{stringliteral}{"{}\(\backslash\)033[31m\%s\(\backslash\)033[0m  "{}}, entry-\/>d\_name);}
\DoxyCodeLine{00397                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00398                 }
\DoxyCodeLine{00399                 \textcolor{keywordflow}{case} DT\_REG:        \textcolor{comment}{// 目录文件普通文件用白色}}
\DoxyCodeLine{00400                     \textcolor{keywordflow}{if} (access(entry-\/>d\_name, X\_OK) == 0)    \textcolor{comment}{// 可执行文件除外，用绿色}}
\DoxyCodeLine{00401                         snprintf(buffer, BUFFER\_SIZE, \textcolor{stringliteral}{"{}\(\backslash\)033[32m\%s\(\backslash\)033[0m  "{}}, entry-\/>d\_name);}
\DoxyCodeLine{00402                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00403                         snprintf(buffer, BUFFER\_SIZE, \textcolor{stringliteral}{"{}\(\backslash\)033[37m\%s\(\backslash\)033[0m  "{}}, entry-\/>d\_name);}
\DoxyCodeLine{00404                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00405 }
\DoxyCodeLine{00406                 \textcolor{keywordflow}{default}:            \textcolor{comment}{// 其他文件用青色}}
\DoxyCodeLine{00407                     snprintf(buffer, BUFFER\_SIZE, \textcolor{stringliteral}{"{}\(\backslash\)033[36m\%s\(\backslash\)033[0m  "{}}, entry-\/>d\_name);}
\DoxyCodeLine{00408                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{00409             \}}
\DoxyCodeLine{00410             \textcolor{keywordflow}{if} (console\_-\/>redirect\_output == \textcolor{keyword}{false}) }
\DoxyCodeLine{00411                 display\_-\/>message(buffer);}
\DoxyCodeLine{00412             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00413             \{}
\DoxyCodeLine{00414                 display\_-\/>message(entry-\/>d\_name);}
\DoxyCodeLine{00415                 display\_-\/>message(\textcolor{stringliteral}{"{}  "{}});}
\DoxyCodeLine{00416             \}}
\DoxyCodeLine{00417         \}}
\DoxyCodeLine{00418     \}}
\DoxyCodeLine{00419     display\_-\/>message(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00420 }
\DoxyCodeLine{00421     \textcolor{comment}{// 结束时将目录更改回当前目录}}
\DoxyCodeLine{00422     ret = chdir(console\_-\/>current\_working\_dictionary);}
\DoxyCodeLine{00423     \textcolor{keywordflow}{if} (ret != 0)   \textcolor{comment}{// 打开目录异常}}
\DoxyCodeLine{00424     \{}
\DoxyCodeLine{00425         \textcolor{keywordflow}{throw} ((std::string)\textcolor{stringliteral}{"{}dir: 无法打开路径 "{}} + real\_path);}
\DoxyCodeLine{00426     \}}
\DoxyCodeLine{00427 }
\DoxyCodeLine{00428     ret = closedir(direction\_pointer);}
\DoxyCodeLine{00429     \textcolor{keywordflow}{if} (ret == -\/1)  \textcolor{comment}{// 关闭目录流异常}}
\DoxyCodeLine{00430     \{}
\DoxyCodeLine{00431         \textcolor{keywordflow}{throw} \textcolor{stringliteral}{"{}dir: 关闭目录流异常"{}};}
\DoxyCodeLine{00432     \}}
\DoxyCodeLine{00433 }
\DoxyCodeLine{00434     \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00435 \}}
\DoxyCodeLine{00436 }
\DoxyCodeLine{00437 sh\_err\_t Executor::execute\_set(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00438 \textcolor{keyword}{}\{}
\DoxyCodeLine{00439     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}set"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00440     }
\DoxyCodeLine{00441     \textcolor{comment}{// 相当于env命令，从兼容性的角度出发，这里选择调用env命令以兼容Linux用户需求}}
\DoxyCodeLine{00442     \textcolor{keywordflow}{return} execute\_env(argc, argv, env);}
\DoxyCodeLine{00443 \}}
\DoxyCodeLine{00444 }
\DoxyCodeLine{00445 sh\_err\_t Executor::execute\_echo(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00446 \textcolor{keyword}{}\{}
\DoxyCodeLine{00447     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}echo"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00448 }
\DoxyCodeLine{00449     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 1; i < argc; ++i)}
\DoxyCodeLine{00450     \{}
\DoxyCodeLine{00451         \textcolor{comment}{// 多个空格和制表符被缩减为一个空格}}
\DoxyCodeLine{00452         \textcolor{keywordflow}{if} (i > 1)}
\DoxyCodeLine{00453             display\_-\/>message(\textcolor{stringliteral}{"{} "{}});}
\DoxyCodeLine{00454 }
\DoxyCodeLine{00455         display\_-\/>message(argv[i]);}
\DoxyCodeLine{00456     \}}
\DoxyCodeLine{00457     display\_-\/>message(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00458 }
\DoxyCodeLine{00459     \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00460 \}}
\DoxyCodeLine{00461 }
\DoxyCodeLine{00462 sh\_err\_t Executor::execute\_help(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00463 \textcolor{keyword}{}\{}
\DoxyCodeLine{00464     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}help"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00465 }
\DoxyCodeLine{00466     FILE* fp = fopen(\textcolor{stringliteral}{"{}README.md"{}}, \textcolor{stringliteral}{"{}r"{}});}
\DoxyCodeLine{00467     \textcolor{keywordflow}{if} (fp == \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00468     \{}
\DoxyCodeLine{00469         \textcolor{keywordflow}{return} SH\_FAILED;}
\DoxyCodeLine{00470     \}}
\DoxyCodeLine{00471 }
\DoxyCodeLine{00472     \textcolor{keywordtype}{char} buffer[BUFFER\_SIZE*2];}
\DoxyCodeLine{00473     \textcolor{keywordflow}{if} (fgets(buffer, BUFFER\_SIZE, fp) == \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00474         \textcolor{keywordflow}{return} SH\_FAILED;    \textcolor{comment}{// 忽略首行}}
\DoxyCodeLine{00475 }
\DoxyCodeLine{00476     \textcolor{keywordtype}{size\_t} size = fread(buffer, 1, BUFFER\_SIZE*2, fp);}
\DoxyCodeLine{00477     \textcolor{keywordflow}{if} (size < 0)}
\DoxyCodeLine{00478     \{}
\DoxyCodeLine{00479         \textcolor{keywordflow}{return} SH\_FAILED;}
\DoxyCodeLine{00480     \}}
\DoxyCodeLine{00481 }
\DoxyCodeLine{00482     \textcolor{keywordflow}{if} (fclose(fp) == -\/1)}
\DoxyCodeLine{00483     \{}
\DoxyCodeLine{00484         \textcolor{keywordflow}{throw} std::exception();}
\DoxyCodeLine{00485     \}}
\DoxyCodeLine{00486 }
\DoxyCodeLine{00487     display\_-\/>message(buffer);}
\DoxyCodeLine{00488     display\_-\/>message(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00489 }
\DoxyCodeLine{00490     \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00491 \}}
\DoxyCodeLine{00492 }
\DoxyCodeLine{00493 sh\_err\_t Executor::execute\_exit(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00494 \textcolor{keyword}{}\{}
\DoxyCodeLine{00495     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}exit"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00496     \textcolor{keywordflow}{return} SH\_EXIT;}
\DoxyCodeLine{00497 \}}
\DoxyCodeLine{00498 }
\DoxyCodeLine{00499 sh\_err\_t Executor::execute\_date(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00500 \textcolor{keyword}{}\{}
\DoxyCodeLine{00501     \textcolor{comment}{// assert(strcmp(argv[0], "{}date"{})==0 \&\& "{}unexpected node type"{});}}
\DoxyCodeLine{00502 }
\DoxyCodeLine{00503     \textcolor{comment}{//获取当前时间}}
\DoxyCodeLine{00504     time\_t t = time(NULL);}
\DoxyCodeLine{00505     \textcolor{keyword}{struct }tm *ptr = localtime(\&t);}
\DoxyCodeLine{00506 }
\DoxyCodeLine{00507     \textcolor{comment}{//生成返回信息}}
\DoxyCodeLine{00508     \textcolor{comment}{// char weekday[16], month[16];}}
\DoxyCodeLine{00509     \textcolor{keywordtype}{char} date[256];}
\DoxyCodeLine{00510     \textcolor{comment}{// strftime(weekday, 16, "{}\%A"{}, ptr);}}
\DoxyCodeLine{00511     \textcolor{comment}{// strftime(month, 16, "{}\%B"{}, ptr);}}
\DoxyCodeLine{00512     strftime(date, 256, \textcolor{stringliteral}{"{}\%c"{}}, ptr);}
\DoxyCodeLine{00513 }
\DoxyCodeLine{00514     \textcolor{comment}{// char buffer[BUFFER\_SIZE];}}
\DoxyCodeLine{00515     \textcolor{comment}{// snprintf(buffer, BUFFER\_SIZE, "{}\%s \%s \%s\(\backslash\)n"{}, weekday, month, date);}}
\DoxyCodeLine{00516 }
\DoxyCodeLine{00517     \textcolor{comment}{// display\_-\/>message(buffer);}}
\DoxyCodeLine{00518     display\_-\/>message(date);}
\DoxyCodeLine{00519     display\_-\/>message(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00520 }
\DoxyCodeLine{00521     \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00522 \}}
\DoxyCodeLine{00523 }
\DoxyCodeLine{00524 sh\_err\_t Executor::execute\_clear(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00525 \textcolor{keyword}{}\{}
\DoxyCodeLine{00526     display\_-\/>message(\textcolor{stringliteral}{"{}\(\backslash\)x1b[H\(\backslash\)x1b[2J"{}});    \textcolor{comment}{// 输出清屏控制 \(\backslash\)x1b[H\(\backslash\)x1b[2J}}
\DoxyCodeLine{00527 }
\DoxyCodeLine{00528     \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00529 \}}
\DoxyCodeLine{00530 }
\DoxyCodeLine{00531 sh\_err\_t Executor::execute\_env(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00532 \textcolor{keyword}{}\{}
\DoxyCodeLine{00533     \textcolor{keyword}{extern} \textcolor{keywordtype}{char} **environ; \textcolor{comment}{//env variables}}
\DoxyCodeLine{00534     \textcolor{keywordtype}{char} ***update\_env = \textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{char} ***\textcolor{keyword}{>}(\&env);}
\DoxyCodeLine{00535     *update\_env = environ;}
\DoxyCodeLine{00536 }
\DoxyCodeLine{00537     \textcolor{keywordflow}{while}(*env)}
\DoxyCodeLine{00538     \{}
\DoxyCodeLine{00539         \textcolor{keywordtype}{char} buffer[BUFFER\_SIZE];}
\DoxyCodeLine{00540         snprintf(buffer, BUFFER\_SIZE, \textcolor{stringliteral}{"{}\%s\(\backslash\)n"{}}, *env++);}
\DoxyCodeLine{00541         display\_-\/>message(buffer);}
\DoxyCodeLine{00542     \}}
\DoxyCodeLine{00543 }
\DoxyCodeLine{00544     \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00545 \}}
\DoxyCodeLine{00546 }
\DoxyCodeLine{00547 sh\_err\_t Executor::execute\_who(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00548 \textcolor{keyword}{}\{}
\DoxyCodeLine{00549     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}who"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00550     display\_-\/>message(console\_-\/>user\_name);}
\DoxyCodeLine{00551     display\_-\/>message(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00552     \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00553 \}}
\DoxyCodeLine{00554 }
\DoxyCodeLine{00555 sh\_err\_t Executor::execute\_mkdir(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00556 \textcolor{keyword}{}\{}
\DoxyCodeLine{00557     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}mkdir"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00558     }
\DoxyCodeLine{00559     \textcolor{keyword}{const} \textcolor{keywordtype}{char} * path = argv[1];}
\DoxyCodeLine{00560     \textcolor{keywordflow}{if} (mkdir(path, S\_IRWXU) == 0)}
\DoxyCodeLine{00561     \{}
\DoxyCodeLine{00562         \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00563     \}}
\DoxyCodeLine{00564     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00565     \{}
\DoxyCodeLine{00566         \textcolor{keywordflow}{return} SH\_FAILED;}
\DoxyCodeLine{00567     \}}
\DoxyCodeLine{00568 }
\DoxyCodeLine{00569 \}}
\DoxyCodeLine{00570 }
\DoxyCodeLine{00571 sh\_err\_t Executor::execute\_rmdir(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00572 \textcolor{keyword}{}\{}
\DoxyCodeLine{00573     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}rmdir"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00574 }
\DoxyCodeLine{00575     \textcolor{keywordflow}{if} (rmdir(argv[1]) == 0)}
\DoxyCodeLine{00576     \{}
\DoxyCodeLine{00577         \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00578     \}}
\DoxyCodeLine{00579     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00580     \{}
\DoxyCodeLine{00581         \textcolor{keywordflow}{return} SH\_FAILED;}
\DoxyCodeLine{00582     \}}
\DoxyCodeLine{00583 \}}
\DoxyCodeLine{00584 }
\DoxyCodeLine{00585 sh\_err\_t Executor::execute\_bg(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00586 \textcolor{keyword}{}\{}
\DoxyCodeLine{00587     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}bg"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00588 }
\DoxyCodeLine{00589     \textcolor{keywordflow}{if} (argc == 1)}
\DoxyCodeLine{00590         \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00591     }
\DoxyCodeLine{00592     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} job\_id = String\_to\_Number<unsigned int>(argv[1]);}
\DoxyCodeLine{00593     \textcolor{keywordtype}{int} \textcolor{keywordtype}{id} = console\_-\/>process\_manager-\/>BackGround(job\_id);}
\DoxyCodeLine{00594     \textcolor{keywordflow}{if} (\textcolor{keywordtype}{id} == 0)}
\DoxyCodeLine{00595     \{}
\DoxyCodeLine{00596         \textcolor{keywordtype}{char} buffer[BUFFER\_SIZE];}
\DoxyCodeLine{00597         snprintf(buffer, BUFFER\_SIZE, \textcolor{stringliteral}{"{}bg: job \%u already in background\(\backslash\)n"{}}, job\_id);}
\DoxyCodeLine{00598         display\_-\/>message(buffer);}
\DoxyCodeLine{00599     \}}
\DoxyCodeLine{00600         }
\DoxyCodeLine{00601     \textcolor{keywordflow}{if} (\textcolor{keywordtype}{id} == -\/1)}
\DoxyCodeLine{00602     \{}
\DoxyCodeLine{00603         \textcolor{keywordtype}{char} buffer[BUFFER\_SIZE];}
\DoxyCodeLine{00604         snprintf(buffer, BUFFER\_SIZE, \textcolor{stringliteral}{"{}bg: \%u : no such job\(\backslash\)n"{}}, job\_id);}
\DoxyCodeLine{00605         display\_-\/>message(buffer);}
\DoxyCodeLine{00606     \}}
\DoxyCodeLine{00607 }
\DoxyCodeLine{00608     \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00609 \}}
\DoxyCodeLine{00610 }
\DoxyCodeLine{00611 sh\_err\_t Executor::execute\_fg(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00612 \textcolor{keyword}{}\{}
\DoxyCodeLine{00613     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}fg"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00614 }
\DoxyCodeLine{00615     \textcolor{keywordflow}{if} (argc == 1)}
\DoxyCodeLine{00616         \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00617     }
\DoxyCodeLine{00618     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} job\_id = String\_to\_Number<unsigned int>(argv[1]);}
\DoxyCodeLine{00619     \textcolor{keywordtype}{int} \textcolor{keywordtype}{id} = console\_-\/>process\_manager-\/>ForeGround(job\_id);}
\DoxyCodeLine{00620     \textcolor{keywordflow}{if} (\textcolor{keywordtype}{id} == -\/1)}
\DoxyCodeLine{00621     \{}
\DoxyCodeLine{00622         \textcolor{keywordtype}{char} buffer[BUFFER\_SIZE];}
\DoxyCodeLine{00623         snprintf(buffer, BUFFER\_SIZE, \textcolor{stringliteral}{"{}bg: \%u : no such job\(\backslash\)n"{}}, job\_id);}
\DoxyCodeLine{00624         display\_-\/>message(buffer);}
\DoxyCodeLine{00625     \}}
\DoxyCodeLine{00626 }
\DoxyCodeLine{00627     \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00628 \}}
\DoxyCodeLine{00629 }
\DoxyCodeLine{00630 sh\_err\_t Executor::execute\_jobs(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00631 \textcolor{keyword}{}\{}
\DoxyCodeLine{00632     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}jobs"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00633 }
\DoxyCodeLine{00634     console\_-\/>ConsoleJobList();}
\DoxyCodeLine{00635 }
\DoxyCodeLine{00636     \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00637 \}}
\DoxyCodeLine{00638 }
\DoxyCodeLine{00639 sh\_err\_t Executor::execute\_exec(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00640 \textcolor{keyword}{}\{}
\DoxyCodeLine{00641     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}exec"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00642 }
\DoxyCodeLine{00643     \textcolor{comment}{// 只有一个参数时不做处理}}
\DoxyCodeLine{00644     \textcolor{keywordflow}{if} (argc == 1)}
\DoxyCodeLine{00645         \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00646 }
\DoxyCodeLine{00647     \textcolor{keywordtype}{int} status\_code = execvp(argv[1], argv+1);        \textcolor{comment}{// 在子进程之中执行}}
\DoxyCodeLine{00648 }
\DoxyCodeLine{00649     \textcolor{keywordflow}{if} (status\_code == -\/1)}
\DoxyCodeLine{00650     \{}
\DoxyCodeLine{00651         \textcolor{keywordflow}{throw} \textcolor{stringliteral}{"{}Execvp Error, terminated incorrectly"{}};}
\DoxyCodeLine{00652     \}}
\DoxyCodeLine{00653 }
\DoxyCodeLine{00654     \textcolor{keywordflow}{return} SH\_UNDEFINED; \textcolor{comment}{// 未识别的命令}}
\DoxyCodeLine{00655 \}}
\DoxyCodeLine{00656 }
\DoxyCodeLine{00657 sh\_err\_t Executor::execute\_test(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00658 \textcolor{keyword}{}\{}
\DoxyCodeLine{00659     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}test"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00660 }
\DoxyCodeLine{00661     \textcolor{keywordtype}{bool} ret = \textcolor{keyword}{false};}
\DoxyCodeLine{00662     \textcolor{keywordflow}{if} (argc == 1)  \textcolor{comment}{// 空字符串，false}}
\DoxyCodeLine{00663     \{}
\DoxyCodeLine{00664         ret = \textcolor{keyword}{false};}
\DoxyCodeLine{00665     \} }
\DoxyCodeLine{00666     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (argc == 2) \textcolor{comment}{// 单目运算}}
\DoxyCodeLine{00667     \{}
\DoxyCodeLine{00668         \textcolor{keywordflow}{if} (strcmp(argv[1], \textcolor{stringliteral}{"{}!"{}}) == 0 || strcmp(argv[1], \textcolor{stringliteral}{"{}-\/z"{}}) == 0)}
\DoxyCodeLine{00669             ret = \textcolor{keyword}{true};}
\DoxyCodeLine{00670         \textcolor{keywordflow}{else}}
\DoxyCodeLine{00671             ret = \textcolor{keyword}{false};}
\DoxyCodeLine{00672     \}}
\DoxyCodeLine{00673     \textcolor{keywordflow}{else} }
\DoxyCodeLine{00674     \{}
\DoxyCodeLine{00675         \textcolor{keywordflow}{if} (strcmp(argv[1], \textcolor{stringliteral}{"{}!"{}}))   \textcolor{comment}{// 第二个参数不是！}}
\DoxyCodeLine{00676         \{}
\DoxyCodeLine{00677             \textcolor{keywordflow}{if} (argc == 3 || argc == 4) \textcolor{comment}{// 双目运算}}
\DoxyCodeLine{00678             \{}
\DoxyCodeLine{00679                 \textcolor{comment}{// 文件测试 与 部分字符串测试}}
\DoxyCodeLine{00680                 ret = Executor::test\_file\_state(argc, argv)}
\DoxyCodeLine{00681                     | Executor::test\_number\_compare(argc, argv)}
\DoxyCodeLine{00682                     | Executor::test\_string\_compare(argc, argv);}
\DoxyCodeLine{00683             \}}
\DoxyCodeLine{00684             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00685             \{}
\DoxyCodeLine{00686                 \textcolor{keywordflow}{return} SH\_ARGS;}
\DoxyCodeLine{00687             \}}
\DoxyCodeLine{00688         \}}
\DoxyCodeLine{00689     \}}
\DoxyCodeLine{00690 }
\DoxyCodeLine{00691     \textcolor{keywordflow}{if} (console\_-\/>GetOutputRedirect() == \textcolor{keyword}{false}) \textcolor{comment}{// 如果是在终端显示就产生正误提示}}
\DoxyCodeLine{00692     \{}
\DoxyCodeLine{00693         \textcolor{keywordflow}{if} (ret)}
\DoxyCodeLine{00694             display\_-\/>message(\textcolor{stringliteral}{"{}true\(\backslash\)n"{}});}
\DoxyCodeLine{00695         \textcolor{keywordflow}{else}}
\DoxyCodeLine{00696             display\_-\/>message(\textcolor{stringliteral}{"{}false\(\backslash\)n"{}});}
\DoxyCodeLine{00697     \}}
\DoxyCodeLine{00698 }
\DoxyCodeLine{00699     \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00700 \}}
\DoxyCodeLine{00701 }
\DoxyCodeLine{00702 sh\_err\_t Executor::execute\_umask(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00703 \textcolor{keyword}{}\{}
\DoxyCodeLine{00704     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}umask"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00705 }
\DoxyCodeLine{00706     \textcolor{keywordflow}{if} (argc == 1)}
\DoxyCodeLine{00707     \{}
\DoxyCodeLine{00708         \textcolor{comment}{// 没有参数，显示当前掩码}}
\DoxyCodeLine{00709         \textcolor{keywordtype}{char} buffer[16];}
\DoxyCodeLine{00710         snprintf(buffer, 16, \textcolor{stringliteral}{"{}\%04o\(\backslash\)n"{}}, console\_-\/>umask\_);   \textcolor{comment}{// 以八进制显示，0补齐}}
\DoxyCodeLine{00711         display\_-\/>message(buffer);}
\DoxyCodeLine{00712     \}}
\DoxyCodeLine{00713     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (argc == 2) \textcolor{comment}{// 有一个输入的参数}}
\DoxyCodeLine{00714     \{}
\DoxyCodeLine{00715         \textcolor{comment}{// 使用函数模板实现进制转换}}
\DoxyCodeLine{00716         console\_-\/>umask\_ = String\_to\_Number<mode\_t>(argv[1]);}
\DoxyCodeLine{00717         }
\DoxyCodeLine{00718         \textcolor{keywordflow}{if} (argv[1][0] == \textcolor{charliteral}{'0'})}
\DoxyCodeLine{00719         \{}
\DoxyCodeLine{00720             \textcolor{keywordflow}{if} (strlen(argv[1]) >= 2 \&\& argv[1][1] == \textcolor{charliteral}{'x'})  \textcolor{comment}{// 十六进制}}
\DoxyCodeLine{00721                 console\_-\/>umask\_ = Hexadecimal\_to\_Decimal(console\_-\/>umask\_);}
\DoxyCodeLine{00722             \textcolor{keywordflow}{else}                                            \textcolor{comment}{// 八进制}}
\DoxyCodeLine{00723                 console\_-\/>umask\_ = Octal\_to\_Decimal(console\_-\/>umask\_);}
\DoxyCodeLine{00724         \}}
\DoxyCodeLine{00725         }
\DoxyCodeLine{00726 \textcolor{preprocessor}{        \#ifdef \_DEBUG\_}}
\DoxyCodeLine{00727         printf(\textcolor{stringliteral}{"{}mask: \%04u \%04o\(\backslash\)n"{}}, console\_-\/>umask\_, console\_-\/>umask\_);}
\DoxyCodeLine{00728 \textcolor{preprocessor}{        \#endif}}
\DoxyCodeLine{00729         umask(console\_-\/>umask\_);}
\DoxyCodeLine{00730     \}}
\DoxyCodeLine{00731     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00732     \{}
\DoxyCodeLine{00733         \textcolor{keywordflow}{return} SH\_ARGS; \textcolor{comment}{// 参数错误}}
\DoxyCodeLine{00734     \}}
\DoxyCodeLine{00735 }
\DoxyCodeLine{00736     \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00737 \}}
\DoxyCodeLine{00738 }
\DoxyCodeLine{00739 sh\_err\_t Executor::execute\_myshell(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[], \textcolor{keywordtype}{char} * \textcolor{keyword}{const} env[])\textcolor{keyword}{ const}}
\DoxyCodeLine{00740 \textcolor{keyword}{}\{}
\DoxyCodeLine{00741     assert(strcmp(argv[0], \textcolor{stringliteral}{"{}myshell"{}})==0 \&\& \textcolor{stringliteral}{"{}unexpected node type"{}});}
\DoxyCodeLine{00742 }
\DoxyCodeLine{00743     std::vector<std::string> FileList;}
\DoxyCodeLine{00744     \textcolor{keywordflow}{if} (argc == 1)}
\DoxyCodeLine{00745     \{}
\DoxyCodeLine{00746         \textcolor{comment}{/*如果shell 被调用时没有使用参数，}}
\DoxyCodeLine{00747 \textcolor{comment}{        它会在屏幕上显示提示符请求用户输入*/}}
\DoxyCodeLine{00748         \textcolor{keywordflow}{while} (1)   \textcolor{comment}{// 循环直到用户有输入}}
\DoxyCodeLine{00749         \{}
\DoxyCodeLine{00750             display\_-\/>prompt();}
\DoxyCodeLine{00751 }
\DoxyCodeLine{00752             \textcolor{keywordtype}{int} len;}
\DoxyCodeLine{00753             \textcolor{keywordtype}{char} input[BUFFER\_SIZE];}
\DoxyCodeLine{00754             len = display\_-\/>InputCommand(input, BUFFER\_SIZE);}
\DoxyCodeLine{00755             }
\DoxyCodeLine{00756             \textcolor{keywordflow}{if} (len == 1 || len < 0)}
\DoxyCodeLine{00757                 \textcolor{keywordflow}{continue};   \textcolor{comment}{// 非有效输入}}
\DoxyCodeLine{00758             \textcolor{keywordflow}{if} (len == 0)}
\DoxyCodeLine{00759                 \textcolor{keywordflow}{return} SH\_EXIT; \textcolor{comment}{// EOF}}
\DoxyCodeLine{00760 }
\DoxyCodeLine{00761 \textcolor{preprocessor}{            \#ifdef \_DEBUG\_}}
\DoxyCodeLine{00762             printf(\textcolor{stringliteral}{"{}len: \%d\(\backslash\)n"{}}, len);}
\DoxyCodeLine{00763 \textcolor{preprocessor}{            \#endif}}
\DoxyCodeLine{00764             input[len-\/1] = \textcolor{charliteral}{'\(\backslash\)0'}; \textcolor{comment}{// 去掉末尾的\(\backslash\)n}}
\DoxyCodeLine{00765 }
\DoxyCodeLine{00766             \textcolor{keywordtype}{int}\& argc\_ = \textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{int}\&\textcolor{keyword}{>}(argc);        \textcolor{comment}{// 引用}}
\DoxyCodeLine{00767             \textcolor{comment}{// char **argv\_ = const\_cast<char **>(argv);   // 指针}}
\DoxyCodeLine{00768 }
\DoxyCodeLine{00769             std::istringstream line(input); \textcolor{comment}{// 字符串流}}
\DoxyCodeLine{00770             std::string word;               \textcolor{comment}{// 分割出的字符串}}
\DoxyCodeLine{00771 }
\DoxyCodeLine{00772             \textcolor{keywordflow}{while} (std::getline(line, word, \textcolor{charliteral}{' '}))}
\DoxyCodeLine{00773             \{}
\DoxyCodeLine{00774                 word = String\_Trim(word);   \textcolor{comment}{// 裁剪}}
\DoxyCodeLine{00775                 \textcolor{keywordflow}{if} (word == \textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{00776                     \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00777                 }
\DoxyCodeLine{00778                 ++argc\_;}
\DoxyCodeLine{00779                 FileList.emplace\_back(word);  \textcolor{comment}{// 需要深拷贝}}
\DoxyCodeLine{00780             \}}
\DoxyCodeLine{00781 }
\DoxyCodeLine{00782             \textcolor{keywordflow}{if} (argc == 1)}
\DoxyCodeLine{00783                 \textcolor{keywordflow}{continue};   \textcolor{comment}{// 未能读到有效输入}}
\DoxyCodeLine{00784 }
\DoxyCodeLine{00785 \textcolor{preprocessor}{            \#ifdef \_DEBUG\_}}
\DoxyCodeLine{00786             Argument\_Display(argc, argv);   \textcolor{comment}{// 调试}}
\DoxyCodeLine{00787 \textcolor{preprocessor}{            \#endif}}
\DoxyCodeLine{00788 }
\DoxyCodeLine{00789             \textcolor{keywordflow}{break};}
\DoxyCodeLine{00790         \}}
\DoxyCodeLine{00791     \}}
\DoxyCodeLine{00792     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00793     \{}
\DoxyCodeLine{00794         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 1; i < argc; ++i) \textcolor{comment}{// 顺序执行}}
\DoxyCodeLine{00795             FileList.push\_back(argv[i]);    \textcolor{comment}{// 将参数加入向量列表}}
\DoxyCodeLine{00796     \}}
\DoxyCodeLine{00797 }
\DoxyCodeLine{00798     assert(argc > 1);   \textcolor{comment}{// 判断}}
\DoxyCodeLine{00799 }
\DoxyCodeLine{00800     \textcolor{keywordtype}{int} input\_fd = console\_-\/>input\_file\_descriptor; \textcolor{comment}{// 存储当前控制台的输入fd}}
\DoxyCodeLine{00801     \textcolor{keywordflow}{for} (std::string File : FileList)}
\DoxyCodeLine{00802     \{}
\DoxyCodeLine{00803         \textcolor{keywordflow}{try}}
\DoxyCodeLine{00804         \{}
\DoxyCodeLine{00805             \textcolor{keywordtype}{int} fd = open(File.c\_str(), O\_RDONLY);   \textcolor{comment}{// 打开文件}}
\DoxyCodeLine{00806             \textcolor{keywordflow}{if} (fd < 0) \textcolor{comment}{// 打开错误处理}}
\DoxyCodeLine{00807             \{}
\DoxyCodeLine{00808                 \textcolor{keywordflow}{throw} std::exception();}
\DoxyCodeLine{00809             \}}
\DoxyCodeLine{00810 }
\DoxyCodeLine{00811 \textcolor{preprocessor}{            \#ifdef \_DEBUG\_}}
\DoxyCodeLine{00812             fprintf(stdout, \textcolor{stringliteral}{"{}FD: \%d Input: \%d Output: \%d\(\backslash\)n"{}}, fd, console\_-\/>input\_file\_descriptor, console\_-\/>output\_file\_descriptor);}
\DoxyCodeLine{00813 \textcolor{preprocessor}{            \#endif}}
\DoxyCodeLine{00814 }
\DoxyCodeLine{00815             console\_-\/>input\_file\_descriptor = fd;   \textcolor{comment}{// 更改输入}}
\DoxyCodeLine{00816             }
\DoxyCodeLine{00817             \textcolor{comment}{// 执行循环}}
\DoxyCodeLine{00818             SHELL::shell\_loop(console\_, display\_, \textcolor{keyword}{const\_cast<}Executor *\textcolor{keyword}{>}(\textcolor{keyword}{this}), \textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{char} **\textcolor{keyword}{>}(env));}
\DoxyCodeLine{00819 }
\DoxyCodeLine{00820             \textcolor{keywordtype}{int} state\_code = close(fd); \textcolor{comment}{// 关闭文件}}
\DoxyCodeLine{00821             \textcolor{keywordflow}{if} (state\_code != 0)    \textcolor{comment}{// 关闭错误处理}}
\DoxyCodeLine{00822             \{}
\DoxyCodeLine{00823                 \textcolor{keywordflow}{throw} std::exception();}
\DoxyCodeLine{00824             \}}
\DoxyCodeLine{00825         \}}
\DoxyCodeLine{00826         \textcolor{keywordflow}{catch}(...)}
\DoxyCodeLine{00827         \{}
\DoxyCodeLine{00828             puts(\textcolor{stringliteral}{"{}every thing"{}});}
\DoxyCodeLine{00829             std::string msg = \textcolor{stringliteral}{"{}\(\backslash\)e[1;31m[ERROR]\(\backslash\)e[0m"{}};}
\DoxyCodeLine{00830             msg = msg + \textcolor{stringliteral}{"{}myshell"{}} + \textcolor{stringliteral}{"{}: ("{}} + File + \textcolor{stringliteral}{"{}) "{}} + strerror(errno) + \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00831             display\_-\/>message(msg.c\_str());}
\DoxyCodeLine{00832         \}}
\DoxyCodeLine{00833         }
\DoxyCodeLine{00834     \}}
\DoxyCodeLine{00835 }
\DoxyCodeLine{00836     console\_-\/>input\_file\_descriptor = input\_fd; \textcolor{comment}{// 恢复控制台的input fd}}
\DoxyCodeLine{00837 }
\DoxyCodeLine{00838     \textcolor{keywordflow}{return} SH\_SUCCESS;}
\DoxyCodeLine{00839 \}}
\DoxyCodeLine{00840 }
\DoxyCodeLine{00841 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{bool} test\_tty(\textcolor{keyword}{const} \textcolor{keywordtype}{char} * file\_name)}
\DoxyCodeLine{00842 \{}
\DoxyCodeLine{00843     \textcolor{keywordflow}{try}}
\DoxyCodeLine{00844     \{}
\DoxyCodeLine{00845         \textcolor{keywordtype}{int} fd = open(file\_name, S\_IREAD);  \textcolor{comment}{// 打开文件获取文件描述符}}
\DoxyCodeLine{00846         \textcolor{keywordtype}{bool} tty = isatty(fd);              \textcolor{comment}{// 判断是否为终端}}
\DoxyCodeLine{00847         close(fd);                          \textcolor{comment}{// 关闭文件}}
\DoxyCodeLine{00848         \textcolor{keywordflow}{return} tty;}
\DoxyCodeLine{00849     \}}
\DoxyCodeLine{00850     \textcolor{keywordflow}{catch}(...)}
\DoxyCodeLine{00851     \{}
\DoxyCodeLine{00852         \textcolor{keywordflow}{return} \textcolor{keyword}{false};                       \textcolor{comment}{// 如果有任何中断则返回false}}
\DoxyCodeLine{00853     \}}
\DoxyCodeLine{00854 \}}
\DoxyCodeLine{00855 }
\DoxyCodeLine{00856 \textcolor{keywordtype}{bool} Executor::test\_file\_state(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keyword}{const} \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[])}
\DoxyCodeLine{00857 \{}
\DoxyCodeLine{00858     assert(argc == 3 || argc == 4);}
\DoxyCodeLine{00859 }
\DoxyCodeLine{00860     \textcolor{keywordflow}{if} (argc == 3)}
\DoxyCodeLine{00861     \{}
\DoxyCodeLine{00862         \textcolor{keyword}{struct }stat file\_stat;}
\DoxyCodeLine{00863 }
\DoxyCodeLine{00864         \textcolor{keywordflow}{if} (lstat(argv[2], \&file\_stat) < 0) \textcolor{comment}{// 文件不存在}}
\DoxyCodeLine{00865         \{}
\DoxyCodeLine{00866             \textcolor{keywordflow}{return} \textcolor{keyword}{false};   \textcolor{comment}{// 不存在一定是false}}
\DoxyCodeLine{00867         \}}
\DoxyCodeLine{00868 }
\DoxyCodeLine{00869         \textcolor{comment}{// 对文件测试参数进行判断}}
\DoxyCodeLine{00870         \textcolor{keywordflow}{switch} (String\_Hash(argv[1]))   \textcolor{comment}{// 为了形式上的优雅，使用switch语句}}
\DoxyCodeLine{00871         \{}
\DoxyCodeLine{00872             \textcolor{comment}{/* 存在性判断 */}}
\DoxyCodeLine{00873             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/e"{}}):  \textcolor{comment}{// 存在判断}}
\DoxyCodeLine{00874                 \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00875             }
\DoxyCodeLine{00876             \textcolor{comment}{/* 文件类型判断 */}}
\DoxyCodeLine{00877             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/f"{}}):  \textcolor{comment}{// 普通文件}}
\DoxyCodeLine{00878                 \textcolor{keywordflow}{return} S\_ISREG(file\_stat.st\_mode);}
\DoxyCodeLine{00879             }
\DoxyCodeLine{00880             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/d"{}}):  \textcolor{comment}{// 目录文件}}
\DoxyCodeLine{00881                 \textcolor{keywordflow}{return} S\_ISDIR(file\_stat.st\_mode);}
\DoxyCodeLine{00882             }
\DoxyCodeLine{00883             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/c"{}}):  \textcolor{comment}{// 字符特殊文件}}
\DoxyCodeLine{00884                 \textcolor{keywordflow}{return} S\_ISCHR(file\_stat.st\_mode);}
\DoxyCodeLine{00885             }
\DoxyCodeLine{00886             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/b"{}}):  \textcolor{comment}{// 块特殊文件}}
\DoxyCodeLine{00887                 \textcolor{keywordflow}{return} S\_ISBLK(file\_stat.st\_mode);}
\DoxyCodeLine{00888             }
\DoxyCodeLine{00889             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/p"{}}):  \textcolor{comment}{// 管道文件}}
\DoxyCodeLine{00890                 \textcolor{keywordflow}{return} S\_ISFIFO(file\_stat.st\_mode);}
\DoxyCodeLine{00891             }
\DoxyCodeLine{00892             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/L"{}}):  \textcolor{comment}{// 符号链接文件}}
\DoxyCodeLine{00893                 \textcolor{keywordflow}{return} S\_ISLNK(file\_stat.st\_mode);}
\DoxyCodeLine{00894             }
\DoxyCodeLine{00895             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/S"{}}):  \textcolor{comment}{// 套接字文件}}
\DoxyCodeLine{00896                 \textcolor{keywordflow}{return} S\_ISSOCK(file\_stat.st\_mode);}
\DoxyCodeLine{00897             }
\DoxyCodeLine{00898             \textcolor{comment}{/* 文件权限判断 */}}
\DoxyCodeLine{00899             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/r"{}}):  \textcolor{comment}{// 只读文件}}
\DoxyCodeLine{00900                 \textcolor{keywordflow}{return} access(argv[1], R\_OK);}
\DoxyCodeLine{00901             }
\DoxyCodeLine{00902             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/w"{}}):  \textcolor{comment}{// 可写文件}}
\DoxyCodeLine{00903                 \textcolor{keywordflow}{return} access(argv[1], W\_OK);}
\DoxyCodeLine{00904             }
\DoxyCodeLine{00905             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/x"{}}):  \textcolor{comment}{// 可执行文件}}
\DoxyCodeLine{00906                 \textcolor{keywordflow}{return} access(argv[1], X\_OK);}
\DoxyCodeLine{00907 }
\DoxyCodeLine{00908             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/O"{}}):  \textcolor{comment}{// 所有者文件}}
\DoxyCodeLine{00909                 \textcolor{keywordflow}{return} file\_stat.st\_uid == getuid();}
\DoxyCodeLine{00910             }
\DoxyCodeLine{00911             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/G"{}}):  \textcolor{comment}{// 组 文件}}
\DoxyCodeLine{00912                 \textcolor{keywordflow}{return} file\_stat.st\_gid == getgid();}
\DoxyCodeLine{00913             }
\DoxyCodeLine{00914             \textcolor{comment}{/* 文件属性判断 */}}
\DoxyCodeLine{00915             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/u"{}}):  \textcolor{comment}{// 用户位属性SUID}}
\DoxyCodeLine{00916                 \textcolor{keywordflow}{return} S\_ISUID \& file\_stat.st\_mode;}
\DoxyCodeLine{00917             }
\DoxyCodeLine{00918             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/g"{}}):  \textcolor{comment}{// 组位属性GUID}}
\DoxyCodeLine{00919                 \textcolor{keywordflow}{return} S\_ISGID \& file\_stat.st\_mode;}
\DoxyCodeLine{00920             }
\DoxyCodeLine{00921             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/k"{}}):  \textcolor{comment}{// Sticky bit属性}}
\DoxyCodeLine{00922                 \textcolor{keywordflow}{return} S\_ISVTX \& file\_stat.st\_mode;}
\DoxyCodeLine{00923             }
\DoxyCodeLine{00924             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/s"{}}):  \textcolor{comment}{// 文件长度非0}}
\DoxyCodeLine{00925                 \textcolor{keywordflow}{return} file\_stat.st\_size > 0;}
\DoxyCodeLine{00926             }
\DoxyCodeLine{00927             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/t"{}}):  \textcolor{comment}{// 文件描述符联系终端}}
\DoxyCodeLine{00928                 \textcolor{keywordflow}{return} test\_tty(argv[2]);}
\DoxyCodeLine{00929             }
\DoxyCodeLine{00930             \textcolor{comment}{/* 其他情况返回错误 */}}
\DoxyCodeLine{00931             \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00932                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00933         \}}
\DoxyCodeLine{00934     \}}
\DoxyCodeLine{00935     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00936     \{}
\DoxyCodeLine{00937         \textcolor{keyword}{struct }stat file\_stat1, file\_stat2;}
\DoxyCodeLine{00938 }
\DoxyCodeLine{00939         \textcolor{keywordflow}{if} (lstat(argv[1], \&file\_stat1) < 0) \textcolor{comment}{// 文件不存在}}
\DoxyCodeLine{00940         \{}
\DoxyCodeLine{00941             \textcolor{keywordflow}{return} \textcolor{keyword}{false};   \textcolor{comment}{// 不存在一定是false}}
\DoxyCodeLine{00942         \}}
\DoxyCodeLine{00943         \textcolor{keywordflow}{if} (lstat(argv[3], \&file\_stat2) < 0) \textcolor{comment}{// 文件不存在}}
\DoxyCodeLine{00944         \{}
\DoxyCodeLine{00945             \textcolor{keywordflow}{return} \textcolor{keyword}{false};   \textcolor{comment}{// 不存在一定是false}}
\DoxyCodeLine{00946         \}}
\DoxyCodeLine{00947 }
\DoxyCodeLine{00948         \textcolor{comment}{// 对文件测试参数进行判断}}
\DoxyCodeLine{00949         \textcolor{keywordflow}{switch} (String\_Hash(argv[2]))   \textcolor{comment}{// 为了形式上的优雅，使用switch语句}}
\DoxyCodeLine{00950         \{}
\DoxyCodeLine{00951             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/nt"{}}):    \textcolor{comment}{// 判断file1是否比file2新}}
\DoxyCodeLine{00952                 \textcolor{keywordflow}{return} test\_timespec\_newer(file\_stat1.st\_mtim, file\_stat2.st\_mtim);}
\DoxyCodeLine{00953             }
\DoxyCodeLine{00954             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/ot"{}}):    \textcolor{comment}{// 判断file1是否比file2旧}}
\DoxyCodeLine{00955                 \textcolor{keywordflow}{return} test\_timespec\_older(file\_stat1.st\_mtim, file\_stat2.st\_mtim);}
\DoxyCodeLine{00956             }
\DoxyCodeLine{00957             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/ef"{}}):    \textcolor{comment}{// 判断file1与file2是否为同一个文件}}
\DoxyCodeLine{00958                 \textcolor{keywordflow}{return} file\_stat1.st\_ino == file\_stat2.st\_ino;}
\DoxyCodeLine{00959             }
\DoxyCodeLine{00960             \textcolor{keywordflow}{default}:                    \textcolor{comment}{/* 其他情况返回错误 */}}
\DoxyCodeLine{00961                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00962         \}}
\DoxyCodeLine{00963     \}}
\DoxyCodeLine{00964 \}}
\DoxyCodeLine{00965 }
\DoxyCodeLine{00966 \textcolor{keywordtype}{bool} Executor::test\_number\_compare(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keyword}{const} \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[])}
\DoxyCodeLine{00967 \{}
\DoxyCodeLine{00968     \textcolor{keywordflow}{if} (argc != 4)}
\DoxyCodeLine{00969         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00970 }
\DoxyCodeLine{00971     }
\DoxyCodeLine{00972     \textcolor{keywordtype}{int} number1 = String\_to\_Number<int>(argv[1]);}
\DoxyCodeLine{00973     \textcolor{keywordtype}{int} number2 = String\_to\_Number<int>(argv[2]);}
\DoxyCodeLine{00974 }
\DoxyCodeLine{00975     \textcolor{comment}{// 对整数测试参数进行判断}}
\DoxyCodeLine{00976     \textcolor{keywordflow}{switch} (String\_Hash(argv[2]))   \textcolor{comment}{// 为了形式上的优雅，使用switch语句}}
\DoxyCodeLine{00977     \{}
\DoxyCodeLine{00978         \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/eq"{}}):}
\DoxyCodeLine{00979         \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}=="{}}):     \textcolor{comment}{// 判断number1是否与number2相等}}
\DoxyCodeLine{00980             \textcolor{keywordflow}{return} number1 == number2;}
\DoxyCodeLine{00981         }
\DoxyCodeLine{00982         \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/ne"{}}):}
\DoxyCodeLine{00983         \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}!="{}}):     \textcolor{comment}{// 判断number1是否与number2不相等}}
\DoxyCodeLine{00984             \textcolor{keywordflow}{return} number1 != number2;}
\DoxyCodeLine{00985         }
\DoxyCodeLine{00986         \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/ge"{}}):}
\DoxyCodeLine{00987         \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}>="{}}):     \textcolor{comment}{// 判断number1是否大于等于number2}}
\DoxyCodeLine{00988             \textcolor{keywordflow}{return} number1 >= number2;}
\DoxyCodeLine{00989         }
\DoxyCodeLine{00990         \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/gt"{}}):}
\DoxyCodeLine{00991         \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}>"{}}):      \textcolor{comment}{// 判断number1是否大于number2}}
\DoxyCodeLine{00992             \textcolor{keywordflow}{return} number1 > number2;}
\DoxyCodeLine{00993         }
\DoxyCodeLine{00994         \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/le"{}}):}
\DoxyCodeLine{00995         \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}<="{}}):     \textcolor{comment}{// 判断number1是否小于等于number2}}
\DoxyCodeLine{00996             \textcolor{keywordflow}{return} number1 <= number2;}
\DoxyCodeLine{00997         }
\DoxyCodeLine{00998         \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/lt"{}}):}
\DoxyCodeLine{00999         \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}<"{}}):      \textcolor{comment}{// 判断number1是否小于number2}}
\DoxyCodeLine{01000             \textcolor{keywordflow}{return} number1 < number2;}
\DoxyCodeLine{01001         }
\DoxyCodeLine{01002         \textcolor{keywordflow}{default}:                    \textcolor{comment}{/* 其他情况返回错误 */}}
\DoxyCodeLine{01003             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01004     \}}
\DoxyCodeLine{01005     }
\DoxyCodeLine{01006 \}}
\DoxyCodeLine{01007 }
\DoxyCodeLine{01008 \textcolor{keywordtype}{bool} Executor::test\_string\_compare(\textcolor{keyword}{const} \textcolor{keywordtype}{int} argc, \textcolor{keyword}{const} \textcolor{keywordtype}{char} * \textcolor{keyword}{const} argv[])}
\DoxyCodeLine{01009 \{}
\DoxyCodeLine{01010     assert(argc == 3 || argc == 4);}
\DoxyCodeLine{01011 }
\DoxyCodeLine{01012     \textcolor{keywordflow}{if} (argc == 3)}
\DoxyCodeLine{01013     \{}
\DoxyCodeLine{01014         \textcolor{comment}{// 对字符串测试参数进行判断}}
\DoxyCodeLine{01015         \textcolor{keywordflow}{switch} (String\_Hash(argv[1]))   \textcolor{comment}{// 为了形式上的优雅，使用switch语句}}
\DoxyCodeLine{01016         \{}
\DoxyCodeLine{01017             \textcolor{comment}{/* 存在性判断 */}}
\DoxyCodeLine{01018             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}-\/n"{}}):  \textcolor{comment}{// 存在判断}}
\DoxyCodeLine{01019                 \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01020                         }
\DoxyCodeLine{01021             \textcolor{comment}{/* 其他情况返回错误 */}}
\DoxyCodeLine{01022             \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01023                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01024         \}}
\DoxyCodeLine{01025     \}}
\DoxyCodeLine{01026     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01027     \{}
\DoxyCodeLine{01028         \textcolor{comment}{// 对字符串测试参数进行判断}}
\DoxyCodeLine{01029         \textcolor{keywordflow}{switch} (String\_Hash(argv[2]))   \textcolor{comment}{// 为了形式上的优雅，使用switch语句}}
\DoxyCodeLine{01030         \{}
\DoxyCodeLine{01031             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}="{}}):     \textcolor{comment}{// 判断string1是否与string2相等}}
\DoxyCodeLine{01032                 \textcolor{keywordflow}{return} !strcmp(argv[1], argv[3]);}
\DoxyCodeLine{01033             }
\DoxyCodeLine{01034             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}!="{}}):     \textcolor{comment}{// 判断string1是否与string2不相等}}
\DoxyCodeLine{01035                 \textcolor{keywordflow}{return} strcmp(argv[1], argv[3]);}
\DoxyCodeLine{01036             }
\DoxyCodeLine{01037             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}\(\backslash\)\(\backslash\)>"{}}):      \textcolor{comment}{// 判断string1是否大于string2}}
\DoxyCodeLine{01038                 \textcolor{keywordflow}{return} strcmp(argv[1], argv[3]) > 0;}
\DoxyCodeLine{01039             }
\DoxyCodeLine{01040             \textcolor{keywordflow}{case} String\_Hash(\textcolor{stringliteral}{"{}\(\backslash\)\(\backslash\)<"{}}):      \textcolor{comment}{// 判断string1是否小于string2}}
\DoxyCodeLine{01041                 \textcolor{keywordflow}{return} strcmp(argv[1], argv[3]) < 0;}
\DoxyCodeLine{01042             }
\DoxyCodeLine{01043             \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01044                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01045         \}}
\DoxyCodeLine{01046     \}}
\DoxyCodeLine{01047 \}}

\end{DoxyCode}
